# Notes and understanding


## Sound generation

From inspecting Contest.pas and Main.pas, I think the original MorseRunner works
by (continuously) creating a .wav file and then playing it back.

The number of samples of this signal is Ini.BufSize, whose def I failed to 
locate.

From a cursory inspection of the code contained in *Contest.pas*, I believe 
audio is largely if not entirely managed and synthesized in the complex Fourier
domain. For instance the background noise seems to be generated by 

    - create an array of N elements for the signal real part
    - create an array of N elements for the signal real part
    - init each elements with **unif.** distributed random numbers, in [-A ; A]
    - where A = 3 * NOISEAMP (NOISEAMP = 6000) 

    The atmospheric noise (QRN) is additionally rendered as it follows:

    1- increase by a factor 20 the limit A, but not of all elements of the array.
    This is done randomly (with prob 0.01 - read 1% of the elements only) 
    and acting only on the real part

    2- simulate a *burst*, randomly generating events (i.e. Stations.AddQrn) with
    probability 0.01

Note: this does NOT happen within a loop through time, since it is in the Fourier
domain. So there is no loop: the buffer is set at the start and its content 
manipulated before (I think) playback.

Maybe this strategy makes it very easy to "mix" signals as well as to change
bandwidth.




## Files comments

- Main.dfm  (GUI definition)
- Main.pas


## Generating the noise (our way)


Note: the code above solves numerically (by the Euler forward method) a
(stochastic) differential equation that acts as a low-pass filter:

dx/dt = -x/tau + u        x(t) is the output, u(t) is (white noise) input

Let's apply the Euler's formula, approximating derivatives with differences
x(k+1) - x(k) / Dt = -x(k)/tau + u(k)
x(k+1) = (1 - Dt/tau) * x(k) + Dt*u(k)

In the actual equation, the "Dt*u(k)" is written in a different way,
this is because strictly speaking a white noise cannot be samples and
some "careful massaging" of the probability theoretical properties is
needed to make the continuous time stochastic o.d.e. equivalent to the
discrete time stochastic iterative algebraic equation.

Note that in the Fourier domain, the filter equation becomes

X(w) jw = -X(w)/tau + U, then  X(w) (jw + 1/tau) = U 

This can be further rewritten as:

X(w) = tau / (jw tau + 1)  U

The magnitude of the transfer function is: tau * 1/sqrt(w^2 tau^2 + 1)
Therefore, changing tau does indeed change the cut-off frequency but also the
DC gain. To remedy this, one can modify the original equation as

dx/dt = -x/tau + u/tau    

But I am not sure this is the problem. Reducing the bandwidth, changes the total
power of the signal.